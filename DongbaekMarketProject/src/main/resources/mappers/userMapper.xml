<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.itwillbs.mapper.UserMapper">
	<resultMap type="com.itwillbs.domain.UserVO" id="userMap">
		<result property="user_id" column="user_id"/>
		<result property="user_pw" column="user_pw"/>
		<result property="salt" column="salt"/>
		<result property="phone" column="phone"/>
		<result property="user_name" column="user_name"/>
		<result property="addr1" column="addr1"/>
		<result property="addr2" column="addr2"/>
		<result property="sns_email" column="sns_email"/>
		<result property="point" column="point"/>
		<result property="identity" column="identity"/>
		<result property="regdate" column="regdate"/>
		<result property="auth" column="auth"/>
	</resultMap>

	<resultMap type="com.itwillbs.domain.AuthVO" id="authMap">
		<result property="id" column="id"/>
		<result property="auth" column="auth"/>
	</resultMap>
	
	<!-- 회원가입 -->
	<insert id="insertUser">
		insert into user(user_id, user_pw, salt, phone, user_name, addr1, addr2, regdate) 
		values (#{user_id}, #{user_pw}, #{salt}, #{phone}, #{user_name}, #{addr1}, #{addr2}, now())
	</insert>
	
	<select id="getSalt" resultType="string">
		select salt from user 
		where user_id = #{user_id}
	</select>
	
	<select id="loginUser" resultType="com.itwillbs.domain.UserVO">
		select * from user 
		where user_id = #{user_id} and user_pw = #{user_pw}
	</select>
	
	<insert id="authUser">
		insert into user_auth (id, auth) 
		value (#{id}, 'ROLE_USER')
	</insert>
	
	<select id="getAuth" resultMap="authMap">
		select * from user_auth 
		where id = #{id}
	</select>
	
	<select id="getUser" resultMap="userMap">
		select u.user_id, u.user_pw, u.phone, u.user_name, u.addr1, u.addr2, u.point, u.identity, u.regdate, a.auth 
		from user u
		left join user_auth a 
		on u.user_id = a.id 
		where u.user_id = #{user_id}
	</select>
	
</mapper>