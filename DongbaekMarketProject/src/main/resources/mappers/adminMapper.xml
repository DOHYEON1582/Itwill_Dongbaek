<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.itwillbs.mapper.AdminMapper">

 <resultMap type="com.itwillbs.domain.AdminCartVO" id="cartMap">
	<result property="cart_code" column="cart_code"/>
	<result property="user_id" column="user_id"/>
	<result property="product_code" column="product_code"/>
	<result property="bundle_code" column="bundle_code"/>
	<result property="count" column="count"/>
	<result property="price" column="price"/>
	<result property="delivery_fee" column="delivery_fee"/>
	<result property="states" column="states"/>
	<result property="refund_reason" column="refund_reason"/>
	
	<collection property="AdminProductVO" resultMap="AdminProductVO"/>
</resultMap>

<resultMap type="com.itwillbs.domain.AdminProductVO" id="AdminProductVO">
	<result property="product_code" column="product_code"/>
	<result property="product_name" column="product_name"/>
	<result property="viewcnt" column="viewcnt"/>
	<result property="img1" column="img1"/>
	<result property="img2" column="img2"/>
	<result property="img3" column="img3"/>
	<result property="product_explain" column="product_explain"/>
	<result property="seller_id" column="seller_id"/>
	<result property="country" column="country"/>
	<result property="max_account" column="max_account"/>
	<result property="category" column="category"/>
	<result property="sub_product" column="sub_product"/>
	<result property="unit" column="unit"/>
</resultMap>



<!-- 회원정보 조회 -->
<select id="getUser" resultType="com.itwillbs.domain.UserVO">
	SELECT * FROM user   
	<choose>
		<when test="user_id != null and user_id != ''">
			WHERE user_id = #{user_id}
		</when>
		<when test="user_name != null and user_name != ''">
			WHERE user_name = #{user_name}
		</when>
		<when test="phone != null and phone != ''">
			WHERE phone = #{phone}
		</when>
	</choose>
	

</select>

<!-- 회원 주문 정보 조회 -->
<select id="getUserOrder" resultType="com.itwillbs.domain.AdminOrderVO">
	SELECT * FROM order_info
		<choose>
			<when test="user_id != null and user_id != ''">
				WHERE user_id = #{user_id}
			</when>
			<when test="user_name != null and user_name != ''">
				WHERE user_name = #{user_name}
			</when>
			<when test="order_code != null and order_code != ''">
				WHERE order_code = #{order_code}
			</when>
		</choose>
		<choose>
			<when test="startDate != null  and startDate != '' and endDate != null  and endDate != ''">
				AND ordr_date between #{startDate} and #{endDate}
			</when>
			<when test="startDate != null  and startDate != '' and (endDate == null  or endDate == '')">
				AND <![CDATA[#{startDate}  <= ordr_date ]]>
			</when>
			<when test="(startDate == null  or startDate == '') and endDate != null  and endDate != ''">
				AND <![CDATA[ ordr_date <= #{endDate} ]]>
			</when>
		</choose>
</select>

<select id="orderCart" resultMap="cartMap">
	SELECT  * 
	FROM cart c
	JOIN product p  
	ON c.product_code = p.product_code  
	WHERE bundle_code = (SELECT bundle_code FROM order_info WHERE order_code = #{order_code});

</select>
	
	
</mapper>