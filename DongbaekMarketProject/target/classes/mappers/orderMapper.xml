<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.itwillbs.mapper.OrderMapper">

<resultMap type="com.itwillbs.domain.Order_infoVO" id="order_info">
	<result property="order_code" column="order_code"/>
	<result property="user_id" column="user_id"/>
	<result property="bundle_code" column="bundle_code"/>
	<result property="store_code" column="store_code"/>
	<result property="order_date" column="order_date"/>
	<result property="store_code" column="store_code"/>
	<result property="order_date" column="order_date"/>
	<result property="rcv_name" column="rcv_name"/>
	<result property="rcv_phone" column="rcv_phone"/>
	<result property="rcv_zip" column="rcv_zip"/>
	<result property="rcv_addr1" column="rcv_addr1"/>
	<result property="rcv_addr2" column="rcv_addr2"/>
	<result property="rcv_msg" column="rcv_msg"/>
	<result property="pay_method" column="pay_method"/>
	<result property="delivery_fee" column="delivery_fee"/>
	<result property="total_price" column="total_price"/>
	<result property="cal_check" column="cal_check"/>
	<result property="reservation" column="reservation"/>
	<result property="reduce_point" column="reduce_point"/>
	<result property="add_point" column="add_point"/>

</resultMap>
<resultMap type="com.itwillbs.domain.StoreVO" id="store">
	<result property="store_code" column="store_code"/>
	<result property="market_code" column="market_code"/>
	<result property="seller_id" column="seller_id"/>
	<result property="store_name" column="store_name"/>
	<result property="store_value" column="store_value"/>
	<result property="store_explain" column="store_explain"/>
	<result property="img1" column="img1"/>
	<result property="img2" column="img2"/>
	<result property="img3" column="img3"/>
	<result property="phone" column="phone"/>
	<result property="store_addr1" column="store_addr1"/>
	<result property="store_addr2" column="store_addr2"/>
	<result property="min_price" column="min_price"/>
	<result property="time" column="time"/>
	<result property="status" column="status"/>
</resultMap>

<!-- 업체 주문 정보(모음) 조회 -->
<select id="getStoreOrderList" resultType="com.itwillbs.domain.Order_infoVO">
	SELECT * FROM order_info
		<choose>
			<when test="con == 'store_code'">
				WHERE store_code = #{search}
			</when>
			<when test="con == 'store_name'">
				WHERE store_code = (SELECT store_code FROM store WHERE store_name = #{search})
			</when>
		</choose>
		<choose>
			<when test="startDate != null  and startDate != '' and endDate != null  and endDate != ''">
				AND ordr_date between #{startDate} and #{endDate}
			</when>
			<when test="startDate != null  and startDate != '' and (endDate == null  or endDate == '')">
				AND <![CDATA[#{startDate}  <= ordr_date ]]>
			</when>
			<when test="(startDate == null  or startDate == '') and endDate != null  and endDate != ''">
				AND <![CDATA[ ordr_date <= #{endDate} ]]>
			</when>
		</choose>
</select>

	<!-- 주문 확정 -->
    <update id="confirmOrder">
        UPDATE order_info SET status = 'confirmed' WHERE order_code = #{order_code}
    </update>
    
    <!-- 주문 취소 -->
    <update id="cancelOrder">
        UPDATE order_info SET status = 'cancelled' WHERE order_code = #{order_code}
    </update>
    
    <!-- 주문 환불 -->
    <update id="refundOrder">
        UPDATE order_info SET status = 'refunded' WHERE order_code = #{order_code}
    </update>
</mapper>